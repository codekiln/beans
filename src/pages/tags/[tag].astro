---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BeanEntry from "../../components/BeanEntry.astro";
import { getAllTags, getBeans } from "../../data/beans";
import { withBase } from "../../utils/paths";

export async function getStaticPaths() {
  const tags = await getAllTags();
  return tags.map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;
const beans = await getBeans();
const taggedBeans = beans.filter((bean) => bean.tags.includes(tag));
---
<BaseLayout title={`Tag: ${tag} Â· Beans`} description={`Beans tagged with ${tag}.`} initialCommand={`$ bean tag ${tag}`}>
  <section class="hero">
    <h1>Tag: {tag}</h1>
    <p>{taggedBeans.length} bean(s) match this tag.</p>
    <p>
      <a href={withBase("/")}>[back to all beans]</a>
    </p>
  </section>
  {taggedBeans.map((bean) => (
    <BeanEntry bean={bean} />
  ))}
</BaseLayout>
