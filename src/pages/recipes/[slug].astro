---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getRecipes } from "../../data/recipes";
import { withBase } from "../../utils/paths";

export async function getStaticPaths() {
  const recipes = await getRecipes();
  return recipes.map((recipe) => ({ params: { slug: recipe.slug } }));
}

const { slug } = Astro.params;
const recipes = await getRecipes();
const recipe = recipes.find((entry) => entry.slug === slug);
---
<BaseLayout
  title={`${recipe?.name ?? "Recipe"} Â· Beans`}
  description={`Recipe details for ${recipe?.name ?? "brew"}.`}
  initialCommand={`$ bean recipe ${recipe?.slug ?? ""}`.trim()}
>
  <section class="hero">
    <h1>{recipe?.name}</h1>
    <p>{recipe?.summary}</p>
    <p>
      <a href={withBase("/recipes/")}>[back to recipes]</a>
    </p>
  </section>
  {recipe?.image ? (
    <section class="window">
      <h2 class="section-title">Image</h2>
      <figure class="bean-observation-media">
        <img src={withBase(recipe.image.src)} alt={recipe.image.alt} loading="lazy" />
      </figure>
    </section>
  ) : null}
  <section class="window">
    <h2 class="section-title">Steps</h2>
    <ol>
      {recipe?.steps.map((step) => (
        <li>{step}</li>
      ))}
    </ol>
  </section>
</BaseLayout>
