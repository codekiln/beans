---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BeanEntry from "../../components/BeanEntry.astro";
import { getBeans } from "../../data/beans";
import { withBase } from "../../utils/paths";

export async function getStaticPaths() {
  const beans = await getBeans();
  return beans.map((bean, index) => ({
    params: { slug: bean.slug },
    props: {
      bean,
      prev: index > 0 ? beans[index - 1] : null,
      next: index < beans.length - 1 ? beans[index + 1] : null
    }
  }));
}

const { bean, prev, next } = Astro.props;
const initialCommand = `$ bean log ${bean.data.date} ${bean.data.beanKey}`;
const initialLinkHref = withBase(`/log/${bean.slug}/`);
---
<BaseLayout
  title={`Bean ${bean.data.date} ${bean.data.beanKey} · Beans`}
  description={bean.data.title}
  initialCommand={initialCommand}
  initialLinkHref={initialLinkHref}
>
  <section class="bean-detail">
    <BeanEntry bean={bean} />
    <nav class="bean-nav" aria-label="Bean log navigation">
      {prev ? (
        <a class="bean-nav-link" href={withBase(`/log/${prev.slug}/`)}>
          ← Prev: {prev.data.date} {prev.data.beanKey}
        </a>
      ) : (
        <span class="bean-nav-muted">← Prev</span>
      )}
      {next ? (
        <a class="bean-nav-link" href={withBase(`/log/${next.slug}/`)}>
          Next: {next.data.date} {next.data.beanKey} →
        </a>
      ) : (
        <span class="bean-nav-muted">Next →</span>
      )}
    </nav>
    <p class="bean-back">
      <a href={withBase("/")}>Back to all beans</a>
    </p>
  </section>
</BaseLayout>
